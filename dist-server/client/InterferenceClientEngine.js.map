{"version":3,"sources":["../../src/client/InterferenceClientEngine.js"],"names":["keyCodeTable","durs","noteIndex","rhythmIndex","viewLock","InterferenceClientEngine","gameEngine","options","InterferenceRenderer","syncClient","transport","Transport","notestack","rhythmstack","room","performanceView","btn","document","getElementById","roomNameInput","roomNameErrorText","querySelector","onclick","regex","exec","value","assignToRoom","substring","style","display","addEventListener","e","activeElement","keyCode","console","log","state","start","seconds","getSyncTime","sequencerLoop","pause","controls","KeyboardControls","bindKey","synth","Synth","oscillator","type","modulationFrequency","envelope","attack","decay","sustain","release","toMaster","then","socket","on","roomName","startTime","performance","now","SyncClient","pingId","clientPingTime","request","emit","callback","data","response","serverPingTime","serverPongTime","status","thisTime","length","triggerAttackRelease","scheduleOnce","nextTime","getSecondsAtTime","nextSubdivision","ClientEngine"],"mappings":"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","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\nimport SyncClient from '@ircam/sync/client';\nimport InterferenceRenderer from '../client/InterferenceRenderer';\nimport { Transport, Synth, Frequency } from 'tone';\n\nconst keyCodeTable = {\n    3: 'break',\n    8: 'backspace', // backspace / delete\n    9: 'tab',\n    12: 'clear',\n    13: 'enter',\n    16: 'shift',\n    17: 'ctrl',\n    18: 'alt',\n    19: 'pause/break',\n    20: 'caps lock',\n    27: 'escape',\n    28: 'conversion',\n    29: 'non-conversion',\n    32: 'space',\n    33: 'page up',\n    34: 'page down',\n    35: 'end',\n    36: 'home',\n    37: 'left',\n    38: 'up',\n    39: 'right',\n    40: 'down',\n    41: 'select',\n    42: 'print',\n    43: 'execute',\n    44: 'Print Screen',\n    45: 'insert',\n    46: 'delete',\n    48: '0',\n    49: '1',\n    50: '2',\n    51: '3',\n    52: '4',\n    53: '5',\n    54: '6',\n    55: '7',\n    56: '8',\n    57: '9',\n    58: ':',\n    59: 'semicolon (firefox), equals',\n    60: '<',\n    61: 'equals (firefox)',\n    63: 'ß',\n    64: '@',\n    65: 'a',\n    66: 'b',\n    67: 'c',\n    68: 'd',\n    69: 'e',\n    70: 'f',\n    71: 'g',\n    72: 'h',\n    73: 'i',\n    74: 'j',\n    75: 'k',\n    76: 'l',\n    77: 'm',\n    78: 'n',\n    79: 'o',\n    80: 'p',\n    81: 'q',\n    82: 'r',\n    83: 's',\n    84: 't',\n    85: 'u',\n    86: 'v',\n    87: 'w',\n    88: 'x',\n    89: 'y',\n    90: 'z',\n    91: 'Windows Key / Left ⌘ / Chromebook Search key',\n    92: 'right window key',\n    93: 'Windows Menu / Right ⌘',\n    96: 'numpad 0',\n    97: 'numpad 1',\n    98: 'numpad 2',\n    99: 'numpad 3',\n    100: 'numpad 4',\n    101: 'numpad 5',\n    102: 'numpad 6',\n    103: 'numpad 7',\n    104: 'numpad 8',\n    105: 'numpad 9',\n    106: 'multiply',\n    107: 'add',\n    108: 'numpad period (firefox)',\n    109: 'subtract',\n    110: 'decimal point',\n    111: 'divide',\n    112: 'f1',\n    113: 'f2',\n    114: 'f3',\n    115: 'f4',\n    116: 'f5',\n    117: 'f6',\n    118: 'f7',\n    119: 'f8',\n    120: 'f9',\n    121: 'f10',\n    122: 'f11',\n    123: 'f12',\n    124: 'f13',\n    125: 'f14',\n    126: 'f15',\n    127: 'f16',\n    128: 'f17',\n    129: 'f18',\n    130: 'f19',\n    131: 'f20',\n    132: 'f21',\n    133: 'f22',\n    134: 'f23',\n    135: 'f24',\n    144: 'num lock',\n    145: 'scroll lock',\n    160: '^',\n    161: '!',\n    163: '#',\n    164: '$',\n    165: 'ù',\n    166: 'page backward',\n    167: 'page forward',\n    169: 'closing paren (AZERTY)',\n    170: '*',\n    171: '~ + * key',\n    173: 'minus (firefox), mute/unmute',\n    174: 'decrease volume level',\n    175: 'increase volume level',\n    176: 'next',\n    177: 'previous',\n    178: 'stop',\n    179: 'play/pause',\n    180: 'e-mail',\n    181: 'mute/unmute (firefox)',\n    182: 'decrease volume level (firefox)',\n    183: 'increase volume level (firefox)',\n    186: 'semi-colon / ñ',\n    187: 'equal sign',\n    188: 'comma',\n    189: 'dash',\n    190: 'period',\n    191: 'forward slash / ç',\n    192: 'grave accent / ñ / æ',\n    193: '?, / or °',\n    194: 'numpad period (chrome)',\n    219: 'open bracket',\n    220: 'back slash',\n    221: 'close bracket / å',\n    222: 'single quote / ø',\n    223: '`',\n    224: 'left or right ⌘ key (firefox)',\n    225: 'altgr',\n    226: '< /git >',\n    230: 'GNOME Compose Key',\n    231: 'ç',\n    233: 'XF86Forward',\n    234: 'XF86Back',\n    240: 'alphanumeric',\n    242: 'hiragana/katakana',\n    243: 'half-width/full-width',\n    244: 'kanji',\n    255: 'toggle touchpad'\n};\n\nconst durs = ['4n', '8n', '6n'];\nlet noteIndex = 0;\nlet rhythmIndex = 0;\nlet viewLock = false;\n\nexport default class InterferenceClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n        super(gameEngine, options, InterferenceRenderer);\n\n        this.syncClient = null;\n        this.transport = Transport;\n        this.notestack = [];\n        this.rhythmstack = ['4n'];\n        this.room = null;\n        this.performanceView = false;\n    }\n\n    start() {\n        super.start()\n\n        let btn = document.getElementById('startButton');\n        let roomNameInput = document.getElementById('roomNameInput');\n        let roomNameErrorText = document.querySelector('#startMenu .room-input-error');\n\n        btn.onclick = () => {\n            let regex = /^\\w+$/;\n            if (regex.exec(roomNameInput.value) !== null) {\n                this.assignToRoom(roomNameInput.value.substring(0, 20));\n            } else {\n                roomNameErrorText.style.display = 'inline';\n            }\n        };\n\n        // LOCAL CONTROLS\n        // Any inputs that do nothing server-side (i.e. doesn't need to be known by other players)\n        document.addEventListener('keypress', e => {\n            if (document.activeElement === roomNameInput) {\n                if (keyCodeTable[e.keyCode] === 'enter') {\n                    let regex = /^\\w+$/;\n                    if (regex.exec(roomNameInput.value) !== null) {\n                        this.assignToRoom(roomNameInput.value.substring(0, 20));\n                    } else {\n                        roomNameErrorText.style.display = 'inline';\n                    }\n                }\n            }\n            else {\n                if (keyCodeTable[e.keyCode] === 'space') {\n                    console.log('space');\n                    if (this.transport.state !== 'started') {\n                        this.transport.start();\n                        this.transport.seconds = this.syncClient.getSyncTime();\n                        this.sequencerLoop(0);\n                    }   \n                    else {\n                        this.transport.pause();\n                    }\n                }\n                if (keyCodeTable[e.keyCode] === 'v') {\n                    if (!viewLock) this.performanceView = !this.performanceView;\n                }\n                if (keyCodeTable[e.keyCode] === 'forward slash / ç') {\n                    viewLock = !viewLock;\n                }\n            }\n        });\n\n        // NETWORKED CONTROLS\n        // These inputs will also be processed on the server\n        console.log('binding keys');\n        this.controls = new KeyboardControls(this);\n        //this.controls.bindKey('space', 'space');\n        this.controls.bindKey('n', 'n');\n        this.controls.bindKey('c', 'c');\n\n\n        this.synth = new Synth({\n            oscillator: {\n                type: 'sine',\n                modulationFrequency: 0.2\n            },\n            envelope: {\n                attack: 0,\n                decay: 0.1,\n                sustain: 0,\n                release: 0.1,\n            }\n        }).toMaster();\n \n        /*\n        // show try-again button\n        this.gameEngine.on('objectDestroyed', (obj) => {\n            if (obj.playerId === gameEngine.playerId) {\n                document.body.classList.add('lostGame');\n                document.querySelector('#tryAgain').disabled = false;\n            }\n        });\n        */\n        /*\n        this.mouseX = null;\n        this.mouseY = null;\n\n        document.addEventListener('mousemove', this.updateMouseXY.bind(this), false);\n        document.addEventListener('mouseenter', this.updateMouseXY.bind(this), false);\n        document.addEventListener('touchmove', this.updateMouseXY.bind(this), false);\n        document.addEventListener('touchenter', this.updateMouseXY.bind(this), false);\n        this.gameEngine.on('client__preStep', this.sendMouseAngle.bind(this));\n        */\n        \n        /*\n        // click event for \"try again\" button\n        document.querySelector('#tryAgain').addEventListener('click', () => {\n            this.socket.emit('requestRestart');\n        }); */\n        \n        /*\n        document.querySelector('#reconnect').addEventListener('click', () => {\n            window.location.reload();\n        }); */\n\n        //this.controls.bindKey('left', 'left', { repeat: true });\n        //this.controls.bindKey('right', 'right', { repeat: true });\n        //this.controls.bindKey('up', 'up', { repeat: true } );\n    }\n\n    connect(options = {}) {\n        return super.connect().then(() => {\n            this.socket.on('assignedRoom', roomName => { \n                this.room = roomName;\n                const startTime = performance.now();\n                this.syncClient = new SyncClient(() => { return (performance.now() - startTime) / 1000 });\n                this.syncClient.start(\n                    // send function\n                    (pingId, clientPingTime) => {\n                        var request = [];\n                        request[0] = 0; // we send a ping\n                        request[1] = pingId;\n                        request[2] = clientPingTime;\n\n                        //console.log('[ping] - id: %s, pingTime: %s', request[1], request[2]);\n\n                        this.socket.emit('syncClientData', request);\n                    },       \n                    // receive function  \n                    callback => {\n                        // unpack args before executing the callback\n                        this.socket.on('syncServerData', function (data) {\n                            var response = data;\n\n                            if (response[0] === 1) { // this is a pong\n                                var pingId = response[1];\n                                var clientPingTime = response[2];\n                                var serverPingTime = response[3];\n                                var serverPongTime = response[4];\n\n                                //console.log('[pong] - id: %s, clientPingTime: %s, serverPingTime: %s, serverPongTime: %s',\n                                //pingId, clientPingTime, serverPingTime, serverPongTime);\n\n                                callback(pingId, clientPingTime, serverPingTime, serverPongTime);\n                            }\n                        });\n                    }, \n                    // status report function\n                    status => { }//console.log(status); }\n                );\n            });\n        });\n    }\n\n    assignToRoom(roomName) {\n        if (this.socket) {\n            this.socket.emit('assignToRoom', roomName);\n            document.getElementById('startMenuWrapper').style.display = 'none';\n        }\n    }\n\n    sequencerLoop(thisTime) {\n        this.rhythmstack = ['4n'];\n        console.log('step');\n        if (this.notestack.length && this.rhythmstack.length) {\n            if (noteIndex >= this.notestack.length) noteIndex = 0;\n            if (rhythmIndex >= this.rhythmstack.length) rhythmIndex = 0;\n            this.synth.triggerAttackRelease(this.notestack[noteIndex], '8n', thisTime)\n            this.transport.scheduleOnce(nextTime => { this.sequencerLoop(nextTime); }, \n                Transport.getSecondsAtTime(Transport.nextSubdivision(this.rhythmstack[rhythmIndex]))\n            );\n            noteIndex++;\n            rhythmIndex++;\n        }\n        else {\n            noteIndex = 0;\n            rhythmIndex = 0;\n            this.transport.scheduleOnce(nextTime => { this.sequencerLoop(nextTime) }, \n                Transport.getSecondsAtTime(Transport.nextSubdivision('1m'))\n            );\n        }\n    }\n\n    /*\n    updateMouseXY(e) {\n        e.preventDefault();\n        if (e.touches) e = e.touches.item(0);\n        this.mouseX = e.pageX;\n        this.mouseY = e.pageY;\n    }\n\n    sendMouseAngle() {\n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n        if (this.mouseY === null || player === null) return;\n\n        let mouseX = (this.mouseX - document.body.clientWidth/2) / this.zoom;\n        let mouseY = (this.mouseY - document.body.clientHeight/2) / this.zoom;\n        let dx = mouseY - player.position.y;\n        let dy = mouseX - player.position.x;\n        if (Math.sqrt(dx * dx + dy * dy) < 0.5) {\n            this.sendInput(this.gameEngine.directionStop, { movement: true });\n            return;\n        }\n\n        let angle = Math.atan2(dx, dy);\n        this.sendInput(angle, { movement: true });\n    }\n    */\n}\n"],"file":"InterferenceClientEngine.js"}